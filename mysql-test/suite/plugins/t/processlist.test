#
# MDEV-15359 Thread stay in "cleaning up" status after finishing
#
source include/have_innodb.inc;

create table t1 (a int) engine=innodb;
start transaction;
insert t1 values (1);
let id=`select connection_id()`;
connect con2,localhost,root;
let s=query_get_value(show engine innodb status,Status,1);
disable_query_log;
eval select regexp_replace("$s", '(?s)^.*MySQL thread id $id,.*root([^\n]*)\n.*', '\\\\1') as `state from show engine innodb status`;
eval select state as `state from show processlist` from information_schema.processlist where id = $id;
enable_query_log;
disconnect con2;
connection default;
drop table t1;
